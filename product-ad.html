<hr style="border:none; border-top:2px solid rgb(59, 64, 74);" />
<h2 style="text-align:center;">Our Favorite Products</h2>
<div id="favorite-products-container" style="display:flex;justify-content:center;gap:40px;margin:30px 0;font-family:inherit;"></div>
<hr style="border:none; border-top:2px solid rgb(59, 64, 74);" />

<script>
const GITHUB_USER = 'wilderbuchanan';
const REPO_NAME = 'web_ads';
const baseRawURL = `https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/companies/`;

// Fetch list of active companies from active_companies.json
async function fetchActiveCompanies() {
  const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_USER}/${REPO_NAME}/main/active-companies.json`);
  if (!res.ok) throw new Error('Failed to fetch active companies list');
  return await res.json();
}

async function fetchAds(company) {
  const res = await fetch(`${baseRawURL}${company}/info.json`);
  if (!res.ok) throw new Error(`Failed to fetch ${company}`);
  const data = await res.json();
  return data.ads.square.map(ad => ({
    image: `${baseRawURL}${company}/${ad.image}`,
    title: ad.title,
    link: ad.link
  }));
}

(async function() {
  const container = document.getElementById('favorite-products-container');
  let allAds = [];

  try {
    const companies = await fetchActiveCompanies();

    for (const company of companies) {
      const ads = await fetchAds(company);
      allAds.push(...ads);
    }

    allAds.sort(() => Math.random() - 0.5);
    const selectedAds = allAds.slice(0, 3);

    selectedAds.forEach(ad => {
      const adDiv = document.createElement('div');
      adDiv.style.textAlign = 'center';
      adDiv.style.maxWidth = '250px';
      adDiv.style.padding = '10px';
      adDiv.style.fontFamily = 'inherit';

      adDiv.innerHTML = `
        <a href="${ad.link}" target="_blank">
          <img src="${ad.image}" alt="${ad.title}" style="width:100%; border-radius:8px; margin-bottom:10px;"/>
        </a>
        <p style="margin-top:10px;font-size:inherit;line-height:1.4;">${ad.title}</p>
      `;
      container.appendChild(adDiv);
    });
  } catch (error) {
    container.innerHTML = `<p>Error loading ads.</p>`;
    console.error(error);
  }
})();
</script>
